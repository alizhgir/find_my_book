import streamlit as st
import pandas as pd
import numpy as np
import time
import base64
import requests
from PIL import Image
from io import BytesIO
from IPython.core.display import HTML, display

from model.bert import recommend


list_genre = ['–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–∑–∞', '–û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–µ–∫—Ç–∏–≤—ã',
              '–ó–∞—Ä—É–±–µ–∂–Ω—ã–µ –¥–µ—Ç–µ–∫—Ç–∏–≤—ã', '–ò—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–µ–∫—Ç–∏–≤—ã', '–û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞', '–ó–∞—Ä—É–±–µ–∂–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞',
              '–û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ñ—ç–Ω—Ç–µ–∑–∏', '–ó–∞—Ä—É–±–µ–∂–Ω–æ–µ —Ñ—ç–Ω—Ç–µ–∑–∏', '–£–∂–∞—Å—ã', '–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –±–æ–µ–≤–∏–∫',
              '–†–æ—Å—Å–∏–π—Å–∫–∏–µ –ª—é–±–æ–≤–Ω—ã–µ —Ä–æ–º–∞–Ω—ã', '–ó–∞—Ä—É–±–µ–∂–Ω—ã–µ –ª—é–±–æ–≤–Ω—ã–µ —Ä–æ–º–∞–Ω—ã', '–ü–æ—ç–∑–∏—è', '–î—Ä–∞–º–∞—Ç—É—Ä–≥–∏—è',
              '–ü—É–±–ª–∏—Ü–∏—Å—Ç–∏–∫–∞', '–ë–∏–æ–≥—Ä–∞—Ñ–∏–∏', '–ú–µ–º—É–∞—Ä—ã', '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ä–æ–º–∞–Ω—ã', '–ö–æ–º–∏—Å–∫—Å—ã –∏ –º–∞–Ω–≥–∞', '–Æ–º–æ—Ä',
              '–ê—Ñ–æ—Ä–∏–∑–º—ã –∏ —Ü–∏—Ç–∞—Ç—ã', '–ú–∏—Ñ—ã –ª–µ–≥–µ–Ω–¥—ã —ç–ø–æ—Å', '–°–∫–∞–∑–∫–∏', '–ü–æ—Å–ª–æ–≤–∏—Ü—ã –ø–æ–≥–æ–≤–æ—Ä–∫–∏ –∑–∞–≥–∞–¥–∫–∏', '–ü—Ä–æ—á–∏–µ –∏–∑–¥–∞–Ω–∏—è', '–î—Ä—É–≥–æ–µ']


st.header("""
 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—åü§ñ
""", divider='blue')

st.info("""
 - ##### –ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¢–û–ü-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ–¥ –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ –∂–µ–ª–∞–Ω–∏—èüîù
 \n- ##### –í–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –ª–∏—à—å —Å–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å, –∏ –≤—ã–±—Ä–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞‚öôÔ∏è
""")

st.image('images/recsys_image.png', caption='–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ DALL-E')

st.write("""
  - ### –í—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞:
""")

text_users = st.text_input('**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ –≤—ã–±–æ—Ä—É –∫–Ω–∏–≥–∏ (–∫–∞–∫–æ–π –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å):**')

genre_book = st.selectbox('**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∂–∞–Ω—Ä –∫–Ω–∏–≥–∏:**', list_genre)

author = st.text_input('**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞, –µ—Å–ª–∏ –¥–ª—è –≤–∞—Å —ç—Ç–æ –≤–∞–∂–Ω–æ (‚ùó–ù–ï–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):**')

count_recommended = st.slider('**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –í—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å:**', min_value=1, max_value=10, value=5)

push_button = st.button('**–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ >>>**', type='primary')
start_time = time.time()

if push_button:

    recommend_book = recommend(text_users, count_recommended)

    st.write(f"""
     #### –ú–æ–¥–µ–ª—å –Ω–∞—à–ª–∞ –ª—É—á—à–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –í–∞—Åüéâ :
     \n- ##### –≠—Ç–æ –∑–∞–Ω—è–ª–æ –≤—Å–µ–≥–æ {round(time.time() - start_time, 3)} —Å–µ–∫.
    """)
    st.table(recommend_book)
    time.sleep(3)
    with st.sidebar:
        st.info("""
         #### –ü–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ª–∏ –í–∞–º –Ω–∞—à–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏? 
        """)

        col1, col2 = st.columns(2)

        with col1:
            st.button('**–î–∞, –æ—á–µ–Ω—å**üî•', type='primary')
        with col2:
            st.button('**–ù–µ—Ç,–º–æ–∂–Ω–æ –ª—É—á—à–µ**üëéüèª', type='primary')
